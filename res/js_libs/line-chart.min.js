var LineChart = {
    defaultConfig: {
        containerClass: "line-chart",
        w: 600,
        h: 400,
        margin: {top: 10, right: 30, bottom: 30, left: 60},
        gradient: [
            {offset: "0%", color: "blue"},
            {offset: "100%", color: "red"}
        ]
    },
    chart: function () {
        var a = Object.create(LineChart.defaultConfig);
        function chart(selection) {
            selection.each(function (data) {
                // Defensive: flatten data if needed
                if (Array.isArray(data) && Array.isArray(data[0])) data = data[0];

                var margin = a.margin,
                    width = a.w - margin.left - margin.right,
                    height = a.h - margin.top - margin.bottom;

                // Remove old content
                d3.select(this).selectAll("*").remove();

                // Append SVG group
                var svg = d3.select(this)
                    .attr("width", a.w)
                    .attr("height", a.h)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // X axis (numerical)
                var x = d3.scaleLinear()
                    .domain(d3.extent(data, function(d) { return d.x; }))
                    .range([0, width]);
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));

                // Y axis (numerical)
                var y = d3.scaleLinear()
                    .domain([0, d3.max(data, function(d) { return +d.y; })])
                    .range([height, 0]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // Gradient
                var defs = svg.append("defs");
                var grad = defs.append("linearGradient")
                    .attr("id", "line-gradient")
                    .attr("gradientUnits", "userSpaceOnUse")
                    .attr("x1", 0)
                    .attr("y1", y(0))
                    .attr("x2", 0)
                    .attr("y2", y(d3.max(data, function(d) { return +d.y; })));
                grad.selectAll("stop")
                    .data(a.gradient)
                    .enter().append("stop")
                    .attr("offset", function(d) { return d.offset; })
                    .attr("stop-color", function(d) { return d.color; });

                // Line
                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "url(#line-gradient)")
                    .attr("stroke-width", 2)
                    .attr("d", d3.line()
                        .x(function(d) { return x(d.x); })
                        .y(function(d) { return y(d.y); })
                    );
            });
        }
        chart.config = function (b) {
            if (!arguments.length) return a;
            Object.entries(b || {}).forEach(function (kv) { a[kv[0]] = kv[1]; });
            return chart;
        };
        return chart;
    },
    draw: function (a, b, c) {
        var d = LineChart.chart().config(c),
            e = d.config();
        d3.select(a).select("svg").remove();
        d3.select(a)
            .append("svg")
            .attr("width", e.w)
            .attr("height", e.h)
            .datum(b)
            .call(d);
    }
};